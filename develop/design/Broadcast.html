<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Broadcast</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Config" href="Config.html" />
    <link rel="prev" title="Domain Decomposition (Decomp)" href="../devGuide/Decomp.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OMEGA
          </a>
              <div class="version">
                develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/QuickStart.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/OmegaBuild.html">CMake-based Omega Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/DataTypes.html">Data Types and Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/MachEnv.html">Machine Environment (MachEnv)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Broadcast.html">Omega Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Logging.html">Omega Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Decomp.html">Domain Decomposition (Decomp)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/QuickStart.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/DataTypes.html">Data Types and Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/DataTypes.html#arrays-and-yakl">Arrays and YAKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/MachEnv.html">Machine Environment (MachEnv)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Broadcast.html">Omega Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/CondaEnv.html">Development Conda Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Linting.html">Linting Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/BuildDocs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/CMakeBuild.html">Omega Build with CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Logging.html">Developing Omega Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Decomp.html">Domain Decomposition (Decomp)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design documents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Broadcast</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">1 Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">2 Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirement-broadcast-all-supported-data-types">2.1 Requirement: Broadcast all supported data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-broadcast-scalars-and-vectors">2.2 Requirement: Broadcast scalars and vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-broadcast-from-any-rank">2.3 Requirement: Broadcast from any rank</a></li>
<li class="toctree-l3"><a class="reference internal" href="#desired-broadcast-within-alternative-environments">2.4 Desired: Broadcast within alternative environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#desired-non-blocking-broadcast">2.5 Desired: Non-blocking broadcast</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#algorithmic-formulation">3 Algorithmic Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design">4 Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-types-and-parameters">4.1 Data types and parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methods">4.2 Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-from-master-task-in-default-environment">4.2.1 Broadcast from master task in default environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-from-another-rank-within-default-environment">4.2.2 Broadcast from another rank within default environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-from-master-rank-within-a-different-environment">4.2.3 Broadcast from master rank within a different environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-from-another-rank-within-a-different-environment">4.2.4 Broadcast from another rank within a different environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-of-vector-variables">4.2.5 Broadcast of vector variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-blocking-broadcasts">4.2.6 Non-blocking broadcasts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#verification-and-testing">5 Verification and Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#test-scalars-of-all-data-types">5.1 Test scalars of all data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-vectors-of-all-types">5.2 Test vectors of all types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-broadcast-from-other-ranks">5.3 Test broadcast from other ranks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-non-blocking-broadcasts">5.4 Test non-blocking broadcasts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-within-a-subset-environment">5.5 Test within a subset environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataTypes.html">DataTypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Decomp.html">Decomp</a></li>
<li class="toctree-l1"><a class="reference internal" href="Halo.html">Halo</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachEnv.html">MachineEnv</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO.html">Input/Output (IO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="IOStreams.html">IOStreams</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reductions.html">Global Reductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ShallowWaterOmega0.html">Omega v0: Shallow Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeMgr.html">TimeManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="OmegaDesignTemplate.html">Template: MyClassOrModuleName</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OMEGA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Broadcast</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/design/Broadcast.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="broadcast">
<span id="omega-design-broadcast"></span><h1>Broadcast<a class="headerlink" href="#broadcast" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>1 Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>In a parallel environment, it is often useful to broadcast values from
one MPI Rank to the others. In particular, the current design for
OMEGA configuration requires us to broadcast many aspects of that
configuration from the master rank to all others.</p>
</section>
<section id="requirements">
<h2>2 Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<section id="requirement-broadcast-all-supported-data-types">
<h3>2.1 Requirement: Broadcast all supported data types<a class="headerlink" href="#requirement-broadcast-all-supported-data-types" title="Permalink to this heading"></a></h3>
<p>We must be able to broadcast variables of I4, I8, R4, R8, Real,
boolean, std::string.</p>
</section>
<section id="requirement-broadcast-scalars-and-vectors">
<h3>2.2 Requirement: Broadcast scalars and vectors<a class="headerlink" href="#requirement-broadcast-scalars-and-vectors" title="Permalink to this heading"></a></h3>
<p>Generally we will be broadcasting scalar values, but will require
vectors of values in some cases.</p>
</section>
<section id="requirement-broadcast-from-any-rank">
<h3>2.3 Requirement: Broadcast from any rank<a class="headerlink" href="#requirement-broadcast-from-any-rank" title="Permalink to this heading"></a></h3>
<p>The most common use case will broadcast from the master rank but
we must be able to support broadcasting from any rank.</p>
</section>
<section id="desired-broadcast-within-alternative-environments">
<h3>2.4 Desired: Broadcast within alternative environments<a class="headerlink" href="#desired-broadcast-within-alternative-environments" title="Permalink to this heading"></a></h3>
<p>OMEGA plans to support subset partitions of the domain for sub-models,
so we must be able to broadcast only within these sub-groups using
the appropriate communicator.</p>
</section>
<section id="desired-non-blocking-broadcast">
<h3>2.5 Desired: Non-blocking broadcast<a class="headerlink" href="#desired-non-blocking-broadcast" title="Permalink to this heading"></a></h3>
<p>It is desireable with any communication function to be able to
overlap communication and computation using non-blocking forms.</p>
</section>
</section>
<section id="algorithmic-formulation">
<h2>3 Algorithmic Formulation<a class="headerlink" href="#algorithmic-formulation" title="Permalink to this heading"></a></h2>
<p>No algorithms needed beyond the MPI broadcast internal algorithm.</p>
</section>
<section id="design">
<h2>4 Design<a class="headerlink" href="#design" title="Permalink to this heading"></a></h2>
<p>The OMEGA broadcast is mostly just wrappers around the MPI broadcast
function with simplified arguments.</p>
<section id="data-types-and-parameters">
<h3>4.1 Data types and parameters<a class="headerlink" href="#data-types-and-parameters" title="Permalink to this heading"></a></h3>
<p>For non-blocking broadcasts, we will alias the <code class="docutils literal notranslate"><span class="pre">MPI_request</span></code> type
to a Broadcast ID:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">BroadcastID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI_Request</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="methods">
<h3>4.2 Methods<a class="headerlink" href="#methods" title="Permalink to this heading"></a></h3>
<p>We will have four forms of the Broadcast function, each returning an
integer error code.  Note that in the interfaces below, we could
template based on data type, but prefer to overload to keep the
interfaces cleaner.</p>
<section id="broadcast-from-master-task-in-default-environment">
<h4>4.2.1 Broadcast from master task in default environment<a class="headerlink" href="#broadcast-from-master-task-in-default-environment" title="Permalink to this heading"></a></h4>
<p>The first form is the simplest for a broadcast within the default
environment and from the master task:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">Broadcast</span><span class="p">([</span><span class="n">data</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">[data</span> <span class="pre">type]</span></code> is one of the supported types (I4, I8 R4, R8, Real,
boolean, std::string). In actual use, this would look like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">Err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Broadcast</span><span class="p">(</span><span class="n">MyIntValue</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="n">Err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Broadcast</span><span class="p">(</span><span class="n">MyRealValue</span><span class="p">);</span>
<span class="p">[</span><span class="n">etc</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">types</span><span class="p">]</span>
</pre></div>
</div>
<p>On the master task, the value would be broadcast and remain unchanged.
The remaining tasks would receive the broadcast and store the value.</p>
</section>
<section id="broadcast-from-another-rank-within-default-environment">
<h4>4.2.2 Broadcast from another rank within default environment<a class="headerlink" href="#broadcast-from-another-rank-within-default-environment" title="Permalink to this heading"></a></h4>
<p>This is similar to the above, but adds the additional argument
for the source rank to broadcast from.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">Broadcast</span><span class="p">([</span><span class="n">data</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w">  </span><span class="c1">///&lt; [in] value to be broadcast</span>
<span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SrcRank</span><span class="w">   </span><span class="c1">///&lt; [in] rank to broadcast from</span>
<span class="w">              </span><span class="p">);</span><span class="w">      </span><span class="c1">//</span>
</pre></div>
</div>
</section>
<section id="broadcast-from-master-rank-within-a-different-environment">
<h4>4.2.3 Broadcast from master rank within a different environment<a class="headerlink" href="#broadcast-from-master-rank-within-a-different-environment" title="Permalink to this heading"></a></h4>
<p>As in 4.2.1, but adds the machine environment as an argument:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">Broadcast</span><span class="p">([</span><span class="n">data</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w">     </span><span class="c1">///&lt; [in] value to be broadcast</span>
<span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="n">MachEnv</span><span class="w"> </span><span class="o">*</span><span class="n">SubEnv</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [in] defined OMEGA environment</span>
<span class="w">              </span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="broadcast-from-another-rank-within-a-different-environment">
<h4>4.2.4 Broadcast from another rank within a different environment<a class="headerlink" href="#broadcast-from-another-rank-within-a-different-environment" title="Permalink to this heading"></a></h4>
<p>As in 4.2.2, but adds the machine environment as an argument:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">Broadcast</span><span class="p">([</span><span class="n">data</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w">     </span><span class="c1">///&lt; [in] value to be broadcast</span>
<span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="n">MachEnv</span><span class="w"> </span><span class="o">*</span><span class="n">SubEnv</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [in] defined OMEGA environment</span>
<span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SrcRank</span><span class="w">      </span><span class="c1">///&lt; [in] rank to broadcast from</span>
<span class="w">              </span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="broadcast-of-vector-variables">
<h4>4.2.5 Broadcast of vector variables<a class="headerlink" href="#broadcast-of-vector-variables" title="Permalink to this heading"></a></h4>
<p>There will be interfaces identical to the above with the value argument
replaced by <code class="docutils literal notranslate"><span class="pre">std::vector&lt;type&gt;</span> <span class="pre">value</span></code> to broadcast a vector of values.</p>
</section>
<section id="non-blocking-broadcasts">
<h4>4.2.6 Non-blocking broadcasts<a class="headerlink" href="#non-blocking-broadcasts" title="Permalink to this heading"></a></h4>
<p>Non-blocking forms of the above for all options will exist that
return a request id. Following the MPI standard, this will all
be named IBroadcast. In addition, an IBroadcastWait will be
included to wait for the request to complete. A non-blocking
sequence would look like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">BroadcastID</span><span class="w"> </span><span class="n">myReqID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IBroadcast</span><span class="p">(</span><span class="n">MyVar</span><span class="p">);</span>
<span class="p">[</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">tasks</span><span class="o">/</span><span class="n">computation</span><span class="w"> </span><span class="p">]</span>
<span class="kt">int</span><span class="w"> </span><span class="n">Err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IBroadcastWait</span><span class="p">(</span><span class="n">MyReqID</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="verification-and-testing">
<h2>5 Verification and Testing<a class="headerlink" href="#verification-and-testing" title="Permalink to this heading"></a></h2>
<section id="test-scalars-of-all-data-types">
<h3>5.1 Test scalars of all data types<a class="headerlink" href="#test-scalars-of-all-data-types" title="Permalink to this heading"></a></h3>
<p>A multi-processor test driver will initialize variables of all supported
types to zero or empty values. The master rank will then set a non-zero
value and broadcast to the remaining ranks. Each rank will verify the
new value is the expected one.</p>
<ul class="simple">
<li><p>tests requirement 2.1</p></li>
</ul>
</section>
<section id="test-vectors-of-all-types">
<h3>5.2 Test vectors of all types<a class="headerlink" href="#test-vectors-of-all-types" title="Permalink to this heading"></a></h3>
<p>Repeat the above with vectors of all types using a set of non-zero
values.</p>
<ul class="simple">
<li><p>tests requirement 2.2</p></li>
</ul>
</section>
<section id="test-broadcast-from-other-ranks">
<h3>5.3 Test broadcast from other ranks<a class="headerlink" href="#test-broadcast-from-other-ranks" title="Permalink to this heading"></a></h3>
<p>Repeat the above two tests except broadcasting from a rank other
than the master rank.</p>
<ul class="simple">
<li><p>tests requirement 2.3</p></li>
</ul>
</section>
<section id="test-non-blocking-broadcasts">
<h3>5.4 Test non-blocking broadcasts<a class="headerlink" href="#test-non-blocking-broadcasts" title="Permalink to this heading"></a></h3>
<p>Initialize non-blocking broadcasts in tandem with all the
above. After verification for the blocking forms, issue the
waits to complete the non-blocking forms and then perform the
verification on the non-blocking results.</p>
</section>
<section id="test-within-a-subset-environment">
<h3>5.5 Test within a subset environment<a class="headerlink" href="#test-within-a-subset-environment" title="Permalink to this heading"></a></h3>
<p>Create a new MachEnv with a subset of ranks and repeat the above tests
with the extra environment argument. Check also that ranks not in
the environment are not corrupted/overwritten with the broadcast value.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../devGuide/Decomp.html" class="btn btn-neutral float-left" title="Domain Decomposition (Decomp)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Config.html" class="btn btn-neutral float-right" title="Config" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>