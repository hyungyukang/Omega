<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Omega v0: Shallow Water</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TimeManager" href="TimeMgr.html" />
    <link rel="prev" title="Global Reductions" href="Reductions.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OMEGA
          </a>
              <div class="version">
                develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/QuickStart.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/OmegaBuild.html">CMake-based Omega Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/DataTypes.html">Data Types and Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/MachEnv.html">Machine Environment (MachEnv)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Broadcast.html">Omega Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Logging.html">Omega Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/QuickStart.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/DataTypes.html">Data Types and Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/DataTypes.html#arrays-and-yakl">Arrays and YAKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/MachEnv.html">Machine Environment (MachEnv)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Broadcast.html">Omega Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/CondaEnv.html">Development Conda Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Linting.html">Linting Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/BuildDocs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/CMakeBuild.html">Omega Build with CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devGuide/Logging.html">Developing Omega Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design documents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Broadcast.html">Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="Config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataTypes.html">DataTypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Decomp.html">Decomp</a></li>
<li class="toctree-l1"><a class="reference internal" href="Halo.html">Halo</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachEnv.html">MachineEnv</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO.html">Input/Output (IO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="IOStreams.html">IOStreams</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reductions.html">Global Reductions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Omega v0: Shallow Water</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">1 Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">2 Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirement-omega-0-will-solve-the-nonlinear-shallow-water-equations-plus-inactive-tracers">2.1 Requirement: Omega-0 will solve the nonlinear shallow water equations, plus inactive tracers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-numerical-method-will-be-the-trisk-formulation">2.2 Requirement: Numerical method will be the TRiSK formulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-omega-0-will-use-mpas-format-unstructured-mesh-domains">2.3 Requirement: Omega-0 will use MPAS format unstructured-mesh domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-omega-0-will-interface-with-polaris-for-preprocessing-and-postprocessing">2.4 Requirement: Omega-0 will interface with polaris for preprocessing and postprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-omega-0-will-run-portably-on-various-doe-architectures-cpu-and-gpu-nodes">2.5 Requirement: Omega-0 will run portably on various DOE architectures (CPU and GPU nodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-omega-0-will-run-on-multi-node-with-domain-decomposition">2.6 Requirement: Omega-0 will run on multi-node with domain decomposition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-correct-convergence-rates-of-operators-and-exact-solutions">2.7 Requirement: Correct convergence rates of operators and exact solutions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-conservation-of-volume-and-tracer">2.8 Requirement: Conservation of volume and tracer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-performance-will-be-at-least-as-good-or-better-than-mpas-ocean">2.9 Requirement: Performance will be at least as good or better than MPAS-Ocean</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirement-full-node-gpu-throughput-will-be-comparable-or-better-than-full-node-cpu-throughput">2.10 Requirement: Full-node GPU throughput will be comparable or better than full-node CPU throughput</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#algorithmic-formulation">3 Algorithmic Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design">4 Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-types-and-parameters">4.1 Data types and parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameters">4.1.1 Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#class-structs-data-types">4.1.2 Class/structs/data types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#methods">4.2 Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#verification-and-testing">5 Verification and Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#convergence-of-individual-terms">5.1 Convergence of individual terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inertia-gravity-wave-linearized-shallow-water-no-tracers">5.2 Inertia Gravity Wave: linearized shallow water, no tracers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manufactured-solution-full-nonlinear-shallow-water-no-tracers">5.3 Manufactured Solution: full nonlinear shallow water, no tracers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracer-transport-on-a-sphere">5.4 Tracer transport on a sphere</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-testing">5.5 Performance testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shallow-water-tests-on-spherical-domains-and-with-realistic-coastlines">5.6 Shallow water tests on spherical domains and with realistic coastlines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-tests-for-omega-0">5.7 Further tests for Omega-0</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TimeMgr.html">TimeManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="OmegaDesignTemplate.html">Template: MyClassOrModuleName</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OMEGA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Omega v0: Shallow Water</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/design/ShallowWaterOmega0.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="omega-v0-shallow-water">
<span id="omega-design-shallow-water-omega0"></span><h1>Omega v0: Shallow Water<a class="headerlink" href="#omega-v0-shallow-water" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>1 Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This design document describes the first version of the Omega ocean model, Omega0. Overall, Omega is an unstructured-mesh ocean model based on TRiSK numerical methods (<a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109004434">Thuburn et al. 2009</a>) that is specifically designed for modern exascale computing architectures. The algorithms in Omega will be nearly identical to those in MPAS-Ocean, but it will be written in c++ rather than Fortran in order to take advantage of libraries to run on GPUs, such as YAKL (Yet Another Kernel Library, <a class="reference external" href="https://link.springer.com/10.1007/s10766-022-00739-0">Norman et al. 2023</a>).</p>
<p>The planned versions of Omega are:</p>
<ol class="arabic simple">
<li><p><strong>Omega-0: Shallow water equations with identical vertical layers and inactive tracers.</strong> There is no vertical transport or advection. The tracer equation is horizontal advection-diffusion, but tracers do not feed back to dynamics. Pressure gradient is simply gradient of sea surface height. Capability is similar to <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109006780">Ringler et al. 2010</a></p></li>
<li><p><strong>Omega-1: Minimal stand-alone primitive equation eddy-permitting model.</strong> This adds active temperature, salinity, density, and pressure as a function of depth. There is a true pressure gradient. Vertical velocity is from the continuity equation. An equation of state and simple vertical mixing scheme are needed. Capability is same as <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1463500313000760">Ringler et al. 2013</a></p></li>
<li><p><strong>Omega-2: Eddying ocean with advanced parameterizations.</strong> This model will have sufficient capability to run realistic global simulations, similar to E3SM V1 <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2018MS001373">Petersen et al. 2019</a>.</p></li>
</ol>
<p>We will produce separate design documents for the time-stepping scheme and the tracer equations in Omega-0. Some of the requirements stated here are repeated or implied by the Omega framework design documents, but are included for clarity.</p>
</section>
<section id="requirements">
<h2>2 Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<section id="requirement-omega-0-will-solve-the-nonlinear-shallow-water-equations-plus-inactive-tracers">
<h3>2.1 Requirement: Omega-0 will solve the nonlinear shallow water equations, plus inactive tracers<a class="headerlink" href="#requirement-omega-0-will-solve-the-nonlinear-shallow-water-equations-plus-inactive-tracers" title="Permalink to this heading"></a></h3>
<p>The governing equations for Omega-0 are conservation of momentum, volume, and tracers in a single layer:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \boldsymbol{u}}{\partial t} + q\left(h\boldsymbol{u}^{\perp}\right) = -g\nabla(h+b) - \nabla K + \nu_2 \nabla^2 \boldsymbol{u} - \nu_4 \nabla^4 \boldsymbol{u} + C_D \frac{\boldsymbol{u}\left|\boldsymbol{u}\right|}{h} - C_W \frac{(\boldsymbol{u}_W - \boldsymbol{u})\left|\boldsymbol{u}_W - \boldsymbol{u}\right|}{h}
\hspace{1cm}   (1)
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial h}{\partial t} + \nabla \cdot \left(h \boldsymbol{u}\right) = 0,
\hspace{1cm}   (2)
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial h \phi}{\partial t} + \nabla \cdot \left(h \boldsymbol{u} \phi\right) = \kappa_2 h \nabla^2 \phi - \kappa_4 h \nabla^4 \phi.
\hspace{1cm}   (3)
\]</div>
<p>The first two equations are from <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109006780">Ringler et al. 2010</a>, equations 2 and 7, with additional viscosity, bottom drag, and wind forcing (see equation 1 in <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2022MS003327">Lilly et al. 2023</a>).
This equation set does not include any vertical advection or diffusion. Omega-0 will have a vertical index for performance testing and future expansion, but vertical layers will be simply redundant.
Additional information on governing equations may be found in chapter 8 of the MPAS User’s Guide (<a class="reference external" href="https://zenodo.org/record/1246893">Petersen et al. 2018</a>).</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>symbol</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>units</p></th>
<th class="head"><p>location</p></th>
<th class="head"><p>notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(C_D\)</span></p></td>
<td><p>bottom drag</p></td>
<td><p>1/m</p></td>
<td><p>edge</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(C_W\)</span></p></td>
<td><p>wind stress coefficient</p></td>
<td><p>1/m</p></td>
<td><p>edge</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(f\)</span></p></td>
<td><p>Coriolis parameter</p></td>
<td><p>1/s</p></td>
<td><p>vertex</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(g\)</span></p></td>
<td><p>gravitational acceleration</p></td>
<td><p>m/s^2</p></td>
<td><p>constant</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(H\)</span></p></td>
<td><p>total unperturbed depth</p></td>
<td><p>m</p></td>
<td><p>cell</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h\)</span></p></td>
<td><p>thickness</p></td>
<td><p>m</p></td>
<td><p>cell</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\({\boldsymbol k}\)</span></p></td>
<td><p>vertical unit vector</p></td>
<td><p>unitless</p></td>
<td><p>none</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
<td><p>kinetic energy</p></td>
<td><p>m^2/s^2</p></td>
<td><p>cell</p></td>
<td><p><span class="math notranslate nohighlight">\(K = \left| {\boldsymbol u} \right|^2 / 2\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(q\)</span></p></td>
<td><p>potential vorticity</p></td>
<td><p>1/m/s</p></td>
<td><p>vertex</p></td>
<td><p><span class="math notranslate nohighlight">\(q = \eta/h\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(t\)</span></p></td>
<td><p>time</p></td>
<td><p>s</p></td>
<td><p>none</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\({\boldsymbol u}\)</span></p></td>
<td><p>velocity</p></td>
<td><p>m/s</p></td>
<td><p>edge</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\({\boldsymbol u}_W\)</span></p></td>
<td><p>wind velocity</p></td>
<td><p>m/s</p></td>
<td><p>edge</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\eta\)</span></p></td>
<td><p>absolute vorticity</p></td>
<td><p>1/s</p></td>
<td><p>vertex</p></td>
<td><p><span class="math notranslate nohighlight">\(\eta={\boldsymbol k} \cdot \nabla \times {\boldsymbol u}+f\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\kappa_2\)</span></p></td>
<td><p>tracer diffusion</p></td>
<td><p>m^2/2</p></td>
<td><p>constant</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\kappa_4\)</span></p></td>
<td><p>biharmonic tracer diffusion</p></td>
<td><p>m^4/2</p></td>
<td><p>constant</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\nu_2\)</span></p></td>
<td><p>viscosity</p></td>
<td><p>m^2/2</p></td>
<td><p>constant</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\nu_4\)</span></p></td>
<td><p>biharmonic viscosity</p></td>
<td><p>m^4/2</p></td>
<td><p>constant</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\phi\)</span></p></td>
<td><p>tracer</p></td>
<td><p>varies</p></td>
<td><p>cell</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>Note: Table created with <a class="reference external" href="https://www.tablesgenerator.com/markdown_tables">markdown table generator</a> and original <a class="reference external" href="https://docs.google.com/spreadsheets/d/1rz-QXDiwfemq5NpSR1XsvomI7aSKQ1myTNweCY4afcE/edit#gid=0">google sheet</a>.</p>
<p>Boundary conditions will include both no-slip and free-slip. The original MPAS-Ocean implementation had no-slip boundaries, implemented by setting vorticity to zero at the boundaries. The free-slip implementation is described by Darren Engwirda in a <a class="reference external" href="https://github.com/E3SM-Ocean-Discussion/E3SM/pull/49">github discussion</a>.</p>
</section>
<section id="requirement-numerical-method-will-be-the-trisk-formulation">
<h3>2.2 Requirement: Numerical method will be the TRiSK formulation<a class="headerlink" href="#requirement-numerical-method-will-be-the-trisk-formulation" title="Permalink to this heading"></a></h3>
<p>The horizontal discretization will be taken from
<a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109004434">Thuburn et al. 2009</a> and <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109006780">Ringler et al. 2010</a>, as described in the algorithmic formulation in Section 3 below. This is the same base formulation as in MPAS-Ocean. In addition, we will consider small alterations from the original MPAS-Ocean horizontal discretization and include them as options if they are of minimal additional effort. This includes the recent AUST formulation in <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S146350032100161X">Calandrini et al. 2021</a> and simple vorticity averaging considered by the Omega team this past year.</p>
</section>
<section id="requirement-omega-0-will-use-mpas-format-unstructured-mesh-domains">
<h3>2.3 Requirement: Omega-0 will use MPAS format unstructured-mesh domains<a class="headerlink" href="#requirement-omega-0-will-use-mpas-format-unstructured-mesh-domains" title="Permalink to this heading"></a></h3>
<p>We will continue to use the MPAS-format netcdf files for input and output, with the same mesh variable names and dimensions. This will facilitate ease of use and interoperability between MPAS-Ocean and Omega.</p>
<p>Omega mesh information will be stored in a separate mesh file, and not be included with initial condition, restart, or output files. This way there is never redundant mesh data stored in these files.</p>
<p>To do: In the design section below, add list of minimum number of variables that defines the mesh, and the additional variables that can be computed on start-up.</p>
</section>
<section id="requirement-omega-0-will-interface-with-polaris-for-preprocessing-and-postprocessing">
<h3>2.4 Requirement: Omega-0 will interface with polaris for preprocessing and postprocessing<a class="headerlink" href="#requirement-omega-0-will-interface-with-polaris-for-preprocessing-and-postprocessing" title="Permalink to this heading"></a></h3>
<p>A substantial investment has already been made in the polaris tools. Continuing the use of polaris for Omega will speed development and encourage the documentation and long-term reproducibility of test cases.</p>
<p>The test cases relevant to this design document are in Section 5 below.</p>
</section>
<section id="requirement-omega-0-will-run-portably-on-various-doe-architectures-cpu-and-gpu-nodes">
<h3>2.5 Requirement: Omega-0 will run portably on various DOE architectures (CPU and GPU nodes)<a class="headerlink" href="#requirement-omega-0-will-run-portably-on-various-doe-architectures-cpu-and-gpu-nodes" title="Permalink to this heading"></a></h3>
<p>Omega will be able to run on all the upcoming DOE architectures and make good use of GPU hardware. This should occur with minimal alterations in the high-level PDE solver code for different platforms.</p>
<p>Options include: writing kernels directly for GPUs in CUDA; adding OpenACC pragmas for the GPUs; or calling libraries such as Kokkos (<a class="reference external" href="https://ieeexplore.ieee.org/document/9485033">Trott et al. 2022</a>), YAKL (<a class="reference external" href="https://link.springer.com/10.1007/s10766-022-00739-0">Norman et al. 2023</a>) or <a class="reference external" href="https://github.com/ROCm-Developer-Tools/HIP">HIP</a> that execute code optimized for specialized architectures on the back-end, while providing a simpler front-end interface for the domain scientist.</p>
</section>
<section id="requirement-omega-0-will-run-on-multi-node-with-domain-decomposition">
<h3>2.6 Requirement: Omega-0 will run on multi-node with domain decomposition<a class="headerlink" href="#requirement-omega-0-will-run-on-multi-node-with-domain-decomposition" title="Permalink to this heading"></a></h3>
<p>This is with MPI and halo communication, as described in framework design documents. Results must be bit-for-bit identical across different number of partitions. This may be demonstrated with the ‘’QU240 partition test’’ in Polaris.</p>
</section>
<section id="requirement-correct-convergence-rates-of-operators-and-exact-solutions">
<h3>2.7 Requirement: Correct convergence rates of operators and exact solutions<a class="headerlink" href="#requirement-correct-convergence-rates-of-operators-and-exact-solutions" title="Permalink to this heading"></a></h3>
<p>Each operator will be tested individually for the proper convergence rate: divergence, gradient, curl interpolated to cell centers, and tangential velocity are all second order; curl at vertices is first order. The details of the convergence tests are explained in section 5.1 below.</p>
</section>
<section id="requirement-conservation-of-volume-and-tracer">
<h3>2.8 Requirement: Conservation of volume and tracer<a class="headerlink" href="#requirement-conservation-of-volume-and-tracer" title="Permalink to this heading"></a></h3>
<p>The total volume of the domain should be conserved to machine precision in the absence of surface volume fluxes. Likewise, the total tracer amount should be conserved to machine precision without surface fluxes. A simple test is to initialize an inactive test tracer with a uniform value of 1.0, and it should remain 1.0 throughout the domain.</p>
</section>
<section id="requirement-performance-will-be-at-least-as-good-or-better-than-mpas-ocean">
<h3>2.9 Requirement: Performance will be at least as good or better than MPAS-Ocean<a class="headerlink" href="#requirement-performance-will-be-at-least-as-good-or-better-than-mpas-ocean" title="Permalink to this heading"></a></h3>
<p>Performance will be assessed with the following metrics:</p>
<ol class="arabic simple">
<li><p>Single CPU throughput</p></li>
<li><p>Parallel CPU scalability to high node counts</p></li>
<li><p>Single GPU throughput</p></li>
</ol>
<p>The first two items will be compared to MPAS-Ocean with the same test configuration. For Omega-0, these may be tested first with the layered shallow water equations (momentum and thickness only) and be compared directly to the results in <a class="reference external" href="https://egusphere.copernicus.org/preprints/2023/egusphere-2023-57">Bishnu et al. 2023a</a>, using the inertia-gravity wave test case described in Section 6.2 below. After tracer transport capabilities are added, performance may be compared against MPAS-Ocean with test cases using active tracers in addition to momentum and thickness.</p>
<p>For these comparisons, MPAS-Ocean will be set up with the identical terms and functionality as Omega-0. This means that vertical advection, vertical mixing, and all parameterizations will be disabled. Comparisons with these terms will be made with Omega-1 and higher and will be described in future design documents.</p>
</section>
<section id="requirement-full-node-gpu-throughput-will-be-comparable-or-better-than-full-node-cpu-throughput">
<h3>2.10 Requirement: Full-node GPU throughput will be comparable or better than full-node CPU throughput<a class="headerlink" href="#requirement-full-node-gpu-throughput-will-be-comparable-or-better-than-full-node-cpu-throughput" title="Permalink to this heading"></a></h3>
<p>For GPU throughput, comparisons should be made between full-node CPU throughput and full-node GPU throughput. For example, <a class="reference external" href="https://docs.nersc.gov/systems/perlmutter/architecture/">Perlmutter at NERSC</a> has nodes with 64 and 128 CPU cores (AMD EPYC 7763) and 4 GPUs (NVIDIA A100). We expect the full-node GPU throughput to be at least as good as the full-node CPU throughput, and potentially a factor of four higher. These numbers depend on the performance specifications of the particular hardware.</p>
<p>Like the previous requirement, tests will first be conducted with layered shallow water equations and later with additional tracer advection. For reference, <a class="reference external" href="https://egusphere.copernicus.org/preprints/2023/egusphere-2023-57">Bishnu et al. 2023a</a> was able to obtain nearly identical throughput between 64 CPU cores and a single GPU on Perlmutter using a Julia code and a layered shallow water test case.</p>
</section>
</section>
<section id="algorithmic-formulation">
<h2>3 Algorithmic Formulation<a class="headerlink" href="#algorithmic-formulation" title="Permalink to this heading"></a></h2>
<p><strong>To do in next pull request:</strong> Copy over algorithmic formulations from <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109004434">Thuburn et al. 2009</a> and <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999109006780">Ringler et al. 2010</a></p>
</section>
<section id="design">
<h2>4 Design<a class="headerlink" href="#design" title="Permalink to this heading"></a></h2>
<p>To do in later PR: Add all design details.</p>
<ol class="arabic simple">
<li><p>Index ordering will be: (time, tracer, horizontal index, vertical index) Note this is c-style indexing, with last index being fastest, i.e. contiguous in memory.</p></li>
<li><p>Time stepping will be multi-level, with an arbitrary number of levels for multistage methods.</p></li>
</ol>
<p>You can include code blocks like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</pre></div>
</div>
<section id="data-types-and-parameters">
<h3>4.1 Data types and parameters<a class="headerlink" href="#data-types-and-parameters" title="Permalink to this heading"></a></h3>
<section id="parameters">
<h4>4.1.1 Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading"></a></h4>
<p>to do: List and define any configuration parameters or public constants.</p>
</section>
<section id="class-structs-data-types">
<h4>4.1.2 Class/structs/data types<a class="headerlink" href="#class-structs-data-types" title="Permalink to this heading"></a></h4>
<p>to do: Describe any public data types and/or the class definition</p>
</section>
</section>
<section id="methods">
<h3>4.2 Methods<a class="headerlink" href="#methods" title="Permalink to this heading"></a></h3>
<p>to do: List and describe all public methods and their interfaces (actual code for
interface that would be in header file). Describe typical use cases.</p>
</section>
</section>
<section id="verification-and-testing">
<h2>5 Verification and Testing<a class="headerlink" href="#verification-and-testing" title="Permalink to this heading"></a></h2>
<section id="convergence-of-individual-terms">
<h3>5.1 Convergence of individual terms<a class="headerlink" href="#convergence-of-individual-terms" title="Permalink to this heading"></a></h3>
<p>The following terms can be tested with sine waves on periodic domains on a cartesian regular-hexagon mesh, as described in <a class="reference external" href="https://www.authorea.com/doi/full/10.22541/essoar.167100170.03833124/v1">Bishnu et al. 2023b</a> (note: update links later when JAMES articles are published) and <a class="reference external" href="https://doi.org/10.5281/zenodo.7439539">Bishnu et al. 2021</a>.</p>
<ol class="arabic simple">
<li><p>Divergence operator at cell centers (2nd order)</p></li>
<li><p>Gradient operator normal to edges (2nd order)</p></li>
<li><p>Curl operator at vertices, i.e. vorticity from a vector field (1st order)</p></li>
<li><p>Curl operator interpolated to cell centers (2nd order)</p></li>
<li><p>Tangential velocity at edges, computed from normal velocity (2nd order)</p></li>
</ol>
<p>Requirements for tests are:</p>
<ul class="simple">
<li><p>compares order of convergence against an expected threshold</p></li>
</ul>
<p>These tests can be conducted at the earliest stages of dycore development, in tandem with the implementation of each operator. In the longer term, these tests will be subsumed by the inertia gravity wave, which tests the order of convergence of all these operators together.</p>
<p>Operator convergence tests may additionally be conducted on the sphere using spherical harmonics for the analytic solution. This was conducted on MPAS-Ocean by Hyun Kang in 2023.</p>
</section>
<section id="inertia-gravity-wave-linearized-shallow-water-no-tracers">
<h3>5.2 Inertia Gravity Wave: linearized shallow water, no tracers<a class="headerlink" href="#inertia-gravity-wave-linearized-shallow-water-no-tracers" title="Permalink to this heading"></a></h3>
<p>The inertia gravity wave test provides an exact solution in time for the linearized shallow water equations (momentum and thickness). It tests the time stepping scheme along with the linearized advection terms, the SSH gradient. It does not test diffusive terms or bottom drag. It is conducted on a doubly periodic cartesian mesh, so does not test boundary conditions. The numerical solution should converge to the analytic solution at 2nd order, as shown in <a class="reference external" href="https://www.authorea.com/doi/full/10.22541/essoar.167100170.03833124/v1">Bishnu et al. 2023b</a> (add figure number and link when published). Also see the inertia gravity test case in Polaris.</p>
<p>Requirements for tests are:</p>
<ul class="simple">
<li><p>expected order of convergence</p></li>
<li><p>conservation of total volume</p></li>
<li><p>automation and reproducibility in polaris</p></li>
</ul>
<p>This test should be conducted as soon as momentum and thickness equations and time-stepping is in place. It does not require any tracer infrastructure.</p>
</section>
<section id="manufactured-solution-full-nonlinear-shallow-water-no-tracers">
<h3>5.3 Manufactured Solution: full nonlinear shallow water, no tracers<a class="headerlink" href="#manufactured-solution-full-nonlinear-shallow-water-no-tracers" title="Permalink to this heading"></a></h3>
<p>The manufactured solution test provides an exact solution in time for the full nonlinear shallow water equations (momentum and thickness). It tests the time stepping scheme along with the the full advection terms and the SSH gradient.  It is conducted on a doubly periodic cartesian mesh, so does not test boundary conditions. Error should converge at 2nd order, as shown in <a class="reference external" href="https://www.authorea.com/doi/full/10.22541/essoar.167100170.03833124/v1">Bishnu et al. 2023b</a> (add figure number and link when published). Also see the manufactured solution test case in Polaris.</p>
<p>Requirements for tests are:</p>
<ul class="simple">
<li><p>expected order of convergence</p></li>
<li><p>conservation of total volume</p></li>
<li><p>automation and reproducibility in polaris</p></li>
</ul>
<p>This test should be conducted as soon as momentum and thickness equations and time-stepping is in place. It does not require any tracer infrastructure.</p>
</section>
<section id="tracer-transport-on-a-sphere">
<h3>5.4 Tracer transport on a sphere<a class="headerlink" href="#tracer-transport-on-a-sphere" title="Permalink to this heading"></a></h3>
<p>A test suite will be used to test horizontal transport schemes on the sphere comprised of test case 1 from <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999105800166">Williamson et al. (1992)</a> and several tests from <a class="reference external" href="https://www.geosci-model-dev.net/5/887/2012/">Lauritzen et al. (2012)</a>.
They test the tracer advection and tracer time stepping. Velocity and thickness are predefined fields and remain fixed, so this does not exercise those equations.</p>
<p>Requirements for tests are:</p>
<ul class="simple">
<li><p>compares order of convergence against an expected threshold</p></li>
<li><p>conservation of total tracer amount</p></li>
<li><p>produces visualization that allows the user to evaluate whether numerical mixing resembles real mixing (preserves functional relationships between tracers)</p></li>
<li><p>tracer min and max values should remain bounded by initial bounds.</p></li>
<li><p>automation and reproducibility in polaris</p></li>
</ul>
</section>
<section id="performance-testing">
<h3>5.5 Performance testing<a class="headerlink" href="#performance-testing" title="Permalink to this heading"></a></h3>
<p>Tests can be conducted with inertia-gravity wave tests but with full non-linear terms and 100 identical layers. Domain will be cartesian resolutions from 64x64 up to 512x512. See performance test results using MPAS-Ocean on Perlmutter, using this setup, in <a class="reference external" href="https://egusphere.copernicus.org/preprints/2023/egusphere-2023-57">Bishnu et al. 2023a</a>. Additionally, we could test spherical cases with a Williamson test case or similar.</p>
<p>Requirements for tests are:</p>
<ul class="simple">
<li><p>Single CPU performance should be as good or better than single CPU MPAS-Ocean.</p></li>
<li><p>GPU tests on single node should be better than single node CPU tests.</p></li>
<li><p>Scaling on CPUs multi-node, up to 4096 cores or higher, should be close to perfect scaling for 512x512 mesh, and as good or better than MPAS-Ocean.</p></li>
<li><p>Scaling on GPUs for multi-node should be close to perfect scaling for 512x512 mesh.</p></li>
<li><p>automation and reproducibility in polaris</p></li>
</ul>
</section>
<section id="shallow-water-tests-on-spherical-domains-and-with-realistic-coastlines">
<h3>5.6 Shallow water tests on spherical domains and with realistic coastlines<a class="headerlink" href="#shallow-water-tests-on-spherical-domains-and-with-realistic-coastlines" title="Permalink to this heading"></a></h3>
<p>Global cases will facilitate the testing of shallow water dynamics on the sphere and of boundary conditions with realistic coastlines, which are not included in any of the previous tests. This includes testing conservation of volume and tracers in global domains.</p>
<p>Potential test cases include:</p>
<ol class="arabic simple">
<li><p>Surface gravity wave: The speed of the surface gravity wave can be compared to the theoretical expectation, as shown in <a class="reference external" href="https://gmd.copernicus.org/articles/16/1297/2023">Pal et al. 2023</a> Appendix A. This could use an aquaplanet domain (flat bottom, no coastlines) to measure the gravity wave speed, and a realistic domain to test boundary conditions and variable-depth bathymetry.</p></li>
<li><p>Stommel double gyre:  This may be compared to an exact solution in the Cartesian case, as in <a class="reference external" href="https://gmd.copernicus.org/articles/16/1297/2023">Pal et al. 2023</a> Appendix B, or qualitative comparisons for the spherical case using either idealized boundaries or an isolated Atlantic Basin domain.</p></li>
</ol>
<p>Tests of realistic global circulation cannot be done with the shallow water equations of Omega-0, but will be part of Omega-1 development with the layered primitive equation model.</p>
</section>
<section id="further-tests-for-omega-0">
<h3>5.7 Further tests for Omega-0<a class="headerlink" href="#further-tests-for-omega-0" title="Permalink to this heading"></a></h3>
<p>Potential additional test cases include the following. These are useful to explore and validate model behavior, but are optional, depending on the time available.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0021999105800166">Williamson et al. 1992</a> as test case 2 or 3, global steady state solutions.</p></li>
<li><p>Global case with unstable jet <a class="reference external" href="https://doi.org/10.3402/tellusa.v56i5.14436">Galewsky et al. 2003</a></p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Reductions.html" class="btn btn-neutral float-left" title="Global Reductions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="TimeMgr.html" class="btn btn-neutral float-right" title="TimeManager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>