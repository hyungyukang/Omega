<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tracers</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Omega V0: Shallow Water" href="../design/OmegaV0ShallowWater.html" />
    <link rel="prev" title="Global Reductions" href="Reductions.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Omega
          </a>
              <div class="version">
                develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/QuickStart.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/OmegaBuild.html">CMake-based Omega Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/DataTypes.html">Data Types and Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/MachEnv.html">Machine Environment (MachEnv)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Config.html">Model Configuration (Config)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Broadcast.html">Omega Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Logging.html">Omega Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Driver.html">Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Decomp.html">Domain Decomposition (Decomp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Dimension.html">Dimension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Field.html">Fields and Metadata (Field)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/IO.html">Parallel IO (IO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Halo.html">Halo Exchanges (Halo)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/HorzMesh.html">Horizontal Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/HorzOperators.html">Horizontal Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/AuxiliaryVariables.html">Auxiliary Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/AuxiliaryState.html">Auxiliary State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/TendencyTerms.html">Tendency Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Tendencies.html">Tendencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/OceanState.html">Ocean State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/TimeMgr.html">Time Manager (TimeMgr)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/TimeStepping.html">Time stepping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Reductions.html">Global Reductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userGuide/Tracers.html">Tracers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="QuickStart.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="CondaEnv.html">Development Conda Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Linting.html">Linting Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildDocs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataTypes.html">Data Types and Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataTypes.html#arrays-and-kokkos">Arrays and Kokkos</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachEnv.html">Machine Environment (MachEnv)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Config.html">Model Configuration (Config)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Driver.html">Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="Broadcast.html">Omega Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="CMakeBuild.html">Omega Build with CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Developing Omega Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Decomp.html">Domain Decomposition (Decomp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dimension.html">Dimension</a></li>
<li class="toctree-l1"><a class="reference internal" href="Field.html">Fields and Metadata (Field)</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO.html">Parallel IO (IO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Halo.html">Halo Exchanges (Halo)</a></li>
<li class="toctree-l1"><a class="reference internal" href="HorzMesh.html">Horizontal Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="HorzOperators.html">Horizontal Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="AuxiliaryVariables.html">Auxiliary Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="AuxiliaryState.html">Auxiliary State</a></li>
<li class="toctree-l1"><a class="reference internal" href="TendencyTerms.html">Tendency Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tendencies.html">Tendencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="OceanState.html">Ocean State</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeMgr.html">Time Manager (TimeMgr)</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeStepping.html">Time stepping</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reductions.html">Global Reductions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tracers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#concepts">Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arrays-in-host-and-device-memory">Arrays in Host and Device Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracer-groups">Tracer Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-levels">Time Levels</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#initialization-and-finalization">Initialization and Finalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-apis">Key APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getall-and-getallhost"><code class="docutils literal notranslate"><span class="pre">getAll</span></code> and <code class="docutils literal notranslate"><span class="pre">getAllHost</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#getgrouprange"><code class="docutils literal notranslate"><span class="pre">getGroupRange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#getbyindex-and-gethostbyindex"><code class="docutils literal notranslate"><span class="pre">getByIndex</span></code> and <code class="docutils literal notranslate"><span class="pre">getHostByIndex</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#getindex"><code class="docutils literal notranslate"><span class="pre">getIndex</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#getfieldbyindex"><code class="docutils literal notranslate"><span class="pre">getFieldByIndex</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#updatetimelevels"><code class="docutils literal notranslate"><span class="pre">updateTimeLevels</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#getnumtracers"><code class="docutils literal notranslate"><span class="pre">getNumTracers</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design documents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design/OmegaV0ShallowWater.html">Omega V0: Shallow Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Broadcast.html">Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/DataTypes.html">DataTypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Decomp.html">Decomp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Driver.html">Driver and Component Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Halo.html">Halo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/HorzMeshClass.html">Horizontal Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/MachEnv.html">MachineEnv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/IO.html">Input/Output (IO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/IOStreams.html">IOStreams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Reductions.html">Global Reductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/State.html">State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Tendency.html">Tendency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Tendencies.html">Tendencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/AuxiliaryVariables.html">Auxiliary variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/AuxiliaryState.html">AuxiliaryState</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/TimeMgr.html">TimeManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Timers.html">Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/TimeStepping.html">Time Stepping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Tracers.html">Tracer Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/Template.html">Template</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Omega</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tracers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/devGuide/Tracers.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="tracers">
<span id="omega-dev-tracers"></span><h1>Tracers<a class="headerlink" href="#tracers" title="Permalink to this heading"></a></h1>
<p>Tracers refer to either heat (temperature) or material carried by a fluid
parcel (e.g., salt, chemical, or biological constituents).</p>
<p>To manage tracer definitions, users will update the <code class="docutils literal notranslate"><span class="pre">TracerDefs.inc</span></code> file
located in the <code class="docutils literal notranslate"><span class="pre">omega/src/ocn</span></code> directory of E3SM. The file contains
Tracer index variables and <code class="docutils literal notranslate"><span class="pre">defineAllTracers</span></code> C++ function defintion that
contains the calls to <code class="docutils literal notranslate"><span class="pre">define</span></code> function per each tracer as shown below:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">IndxTemp</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">Tracers</span><span class="o">::</span><span class="n">IndxInvalid</span><span class="p">;</span>
<span class="kr">inline</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">IndxSalt</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">Tracers</span><span class="o">::</span><span class="n">IndxInvalid</span><span class="p">;</span>
<span class="kr">inline</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">IndxMyBGCTracer</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">Tracers</span><span class="o">::</span><span class="n">IndxInvalid</span><span class="p">;</span>

<span class="c1">// Tracer definitions packaged in a defineAllTracers function</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">defineAllTracers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="n">define</span><span class="p">(</span><span class="s">&quot;Temp&quot;</span><span class="p">,</span><span class="w">                            </span><span class="c1">///&lt; [in] Name of tracer</span>
<span class="w">          </span><span class="s">&quot;Potential Temperature&quot;</span><span class="p">,</span><span class="w">           </span><span class="c1">///&lt; [in] Long name or description</span>
<span class="w">          </span><span class="s">&quot;degree_C&quot;</span><span class="p">,</span><span class="w">                        </span><span class="c1">///&lt; [in] Units</span>
<span class="w">          </span><span class="s">&quot;sea_water_potential_temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [in] CF standard Name</span>
<span class="w">          </span><span class="mf">-273.15</span><span class="p">,</span><span class="w">                           </span><span class="c1">///&lt; [in] min valid field value</span>
<span class="w">          </span><span class="mf">100.0</span><span class="p">,</span><span class="w">                             </span><span class="c1">///&lt; [in] max valid field value</span>
<span class="w">          </span><span class="mf">1.</span><span class="n">e33</span><span class="p">,</span><span class="w">                             </span><span class="c1">///&lt; [in] value for undef entries</span>
<span class="w">          </span><span class="n">IndxTemp</span><span class="p">);</span><span class="w">                         </span><span class="c1">///&lt; [out] (optional) static index</span>

<span class="w">   </span><span class="n">define</span><span class="p">(</span><span class="s">&quot;Salt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Salinity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;psu&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sea_water_salinity&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">50.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="n">e33</span><span class="p">,</span>
<span class="w">          </span><span class="n">IndxSalt</span><span class="p">);</span>
<span class="w">   </span><span class="n">define</span><span class="p">(</span><span class="s">&quot;Debug1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Debug Tracer 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="n">e33</span><span class="p">);</span>
<span class="w">   </span><span class="n">define</span><span class="p">(</span><span class="s">&quot;Debug2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Debug Tracer 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="n">e33</span><span class="p">);</span>
<span class="w">   </span><span class="n">define</span><span class="p">(</span><span class="s">&quot;Debug3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Debug Tracer 3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="n">e33</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To add a new tracer, simply call the <code class="docutils literal notranslate"><span class="pre">define</span></code> function with the appropriate
arguments. Index argument is optional one that allows to access the tracer
data using the given tracer index variable.</p>
<p>The following sections explain the concept and implementation of OMEGA tracers.</p>
<section id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this heading"></a></h2>
<section id="arrays-in-host-and-device-memory">
<h3>Arrays in Host and Device Memory<a class="headerlink" href="#arrays-in-host-and-device-memory" title="Permalink to this heading"></a></h3>
<p>All tracers are stored in a vector of 3-dimensional device and host arrays.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Array3DReal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TracerArrays</span><span class="p">;</span><span class="w">   </span><span class="c1">// Device: multiple time levels</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">HostArray3DReal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TracerArraysH</span><span class="p">;</span><span class="w"> </span><span class="c1">// Host: multiple time levels</span>
</pre></div>
</div>
<p>Each device and host array in the vector has dimensions corresponding to the
number of tracers, the number of cells in the rank, and the vertical levels.</p>
<p>The host tracer array (<code class="docutils literal notranslate"><span class="pre">TracerArraysH</span></code>) is internally managed, so users
should not directly modify it in most cases.</p>
</section>
<section id="tracer-groups">
<h3>Tracer Groups<a class="headerlink" href="#tracer-groups" title="Permalink to this heading"></a></h3>
<p>Each tracer is assigned to a tracer group defined in the OMEGA YAML
configuration file, such as <code class="docutils literal notranslate"><span class="pre">Default.yml</span></code>. A tracer should be assigned to only one group.</p>
<p>To access the member tracers of a group in the code, users can use the
<code class="docutils literal notranslate"><span class="pre">getGroupRange</span></code> function as shown below:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Retrieves a pair of (group start index, group length)</span>
<span class="k">static</span><span class="w"> </span><span class="n">I4</span>
<span class="nf">getGroupRange</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">I4</span><span class="p">,</span><span class="w"> </span><span class="n">I4</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">GroupRange</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [out] Group range</span>
<span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">GroupName</span><span class="w">   </span><span class="c1">///&lt; [in] Group name</span>
<span class="p">);</span>
</pre></div>
</div>
<p>A typical use of this function might look like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get group range</span>
<span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">I4</span><span class="p">,</span><span class="w"> </span><span class="n">I4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GroupRange</span><span class="p">;</span>
<span class="n">I4</span><span class="w"> </span><span class="n">Err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tracers</span><span class="o">::</span><span class="n">getGroupRange</span><span class="p">(</span><span class="n">GroupRange</span><span class="p">,</span><span class="w"> </span><span class="n">GroupName</span><span class="p">);</span>

<span class="c1">// Unpack group range</span>
<span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">StartIndex</span><span class="p">,</span><span class="w"> </span><span class="n">GroupLength</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GroupRange</span><span class="p">;</span>

<span class="c1">// Get all tracers at the current time level (0)</span>
<span class="n">Array3DReal</span><span class="w"> </span><span class="n">TracerArray</span><span class="p">;</span>
<span class="n">Err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OMEGA</span><span class="o">::</span><span class="n">Tracers</span><span class="o">::</span><span class="n">getAll</span><span class="p">(</span><span class="n">TracerArray</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">   </span><span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">&quot;getAll returns an error code: {}.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Err</span><span class="p">);</span>


<span class="n">OMEGA</span><span class="o">::</span><span class="n">parallelFor</span><span class="p">(</span>
<span class="w">   </span><span class="s">&quot;ComputeGroupTendency&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="p">{</span><span class="n">GroupLength</span><span class="p">,</span><span class="w"> </span><span class="n">NCells</span><span class="p">,</span><span class="w"> </span><span class="n">NVertLayers</span><span class="p">},</span>
<span class="w">   </span><span class="n">KOKKOS_LAMBDA</span><span class="p">(</span><span class="n">Int</span><span class="w"> </span><span class="n">iIndex</span><span class="p">,</span><span class="w"> </span><span class="n">Int</span><span class="w"> </span><span class="n">iCell</span><span class="p">,</span><span class="w"> </span><span class="n">Int</span><span class="w"> </span><span class="n">iVert</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">iTracer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TracerArray</span><span class="p">[</span><span class="n">iIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">StartIndex</span><span class="p">];</span>
<span class="w">      </span><span class="c1">// Perform operations on TracerArray(iTracer, iCell, iVert);</span>
<span class="w">   </span><span class="p">});</span>
</pre></div>
</div>
</section>
<section id="time-levels">
<h3>Time Levels<a class="headerlink" href="#time-levels" title="Permalink to this heading"></a></h3>
<p>During the initialization of Tracers, the number of time levels is determined,
and the length of the tracer vectors (<code class="docutils literal notranslate"><span class="pre">TracerArrays</span></code> and <code class="docutils literal notranslate"><span class="pre">TracerArraysH</span></code>)
is set accordingly. The Tracers class internally manages the index of the
current time level in the arrays. To access a specific time level in the
arrays, users will use the integer “0” or negative integers. For example,
the following code retrieves the device tracer arrays for the current and
previous time levels:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get all tracers at the current time level (0)</span>
<span class="n">Array3DReal</span><span class="w"> </span><span class="n">CurrentTracerArray</span><span class="p">;</span>
<span class="n">I4</span><span class="w"> </span><span class="n">Err1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OMEGA</span><span class="o">::</span><span class="n">Tracers</span><span class="o">::</span><span class="n">getAll</span><span class="p">(</span><span class="n">CurrentTracerArray</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Get all tracers at the previous time level (-1)</span>
<span class="n">Array3DReal</span><span class="w"> </span><span class="n">PreviousTracerArray</span><span class="p">;</span>
<span class="n">I4</span><span class="w"> </span><span class="n">Err2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OMEGA</span><span class="o">::</span><span class="n">Tracers</span><span class="o">::</span><span class="n">getAll</span><span class="p">(</span><span class="n">PreviousTracerArray</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="initialization-and-finalization">
<h2>Initialization and Finalization<a class="headerlink" href="#initialization-and-finalization" title="Permalink to this heading"></a></h2>
<p>To use Tracers, the class should first be initialized by calling the
<code class="docutils literal notranslate"><span class="pre">init()</span></code> function and finalized by calling <code class="docutils literal notranslate"><span class="pre">finalize()</span></code>. These function
calls are typically handled within the initialization and finalization of
OMEGA itself, so users may not need to call them separately.</p>
</section>
<section id="key-apis">
<h2>Key APIs<a class="headerlink" href="#key-apis" title="Permalink to this heading"></a></h2>
<section id="getall-and-getallhost">
<h3><code class="docutils literal notranslate"><span class="pre">getAll</span></code> and <code class="docutils literal notranslate"><span class="pre">getAllHost</span></code><a class="headerlink" href="#getall-and-getallhost" title="Permalink to this heading"></a></h3>
<p>These functions return all device and host tracer arrays, respectively. If
the specified <code class="docutils literal notranslate"><span class="pre">TimeLevel</span></code> does not exist, they return a negative integer.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">HostArray3DReal</span><span class="w"> </span><span class="nf">getAllHost</span><span class="p">(</span>
<span class="w">   </span><span class="n">HostArray3DReal</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TracerArrayH</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [out] tracer host array</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TimeLevel</span><span class="w"> </span><span class="c1">///&lt; [in] Time level index</span>
<span class="p">);</span>

<span class="k">static</span><span class="w"> </span><span class="n">Array3DReal</span><span class="w"> </span><span class="nf">getAll</span><span class="p">(</span>
<span class="w">   </span><span class="n">Array3DReal</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TracerArray</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [out] tracer device array</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TimeLevel</span><span class="w"> </span><span class="c1">///&lt; [in] Time level index</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="getgrouprange">
<h3><code class="docutils literal notranslate"><span class="pre">getGroupRange</span></code><a class="headerlink" href="#getgrouprange" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">getGroupRange</span></code> returns a pair of two <code class="docutils literal notranslate"><span class="pre">I4</span></code> values representing the group
start index and the group length. If the group is not found, it returns
negative integers.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="nf">getGroupRange</span><span class="p">(</span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">I4</span><span class="p">,</span><span class="w"> </span><span class="n">I4</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">GroupRange</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [out] Group range</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">GroupName</span><span class="w">   </span><span class="c1">///&lt; [in] Group name</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="getbyindex-and-gethostbyindex">
<h3><code class="docutils literal notranslate"><span class="pre">getByIndex</span></code> and <code class="docutils literal notranslate"><span class="pre">getHostByIndex</span></code><a class="headerlink" href="#getbyindex-and-gethostbyindex" title="Permalink to this heading"></a></h3>
<p>These functions return device and host tracer arrays, respectively, based
on the <code class="docutils literal notranslate"><span class="pre">TracerIndex</span></code>. If the specified <code class="docutils literal notranslate"><span class="pre">TimeLevel</span></code> and/or <code class="docutils literal notranslate"><span class="pre">TracerIndex</span></code>
does not exist, they return a negative integer.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">Array2DReal</span><span class="w"> </span><span class="nf">getByIndex</span><span class="p">(</span>
<span class="w">   </span><span class="n">Array2DReal</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TracerArray</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [out] tracer device array</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TimeLevel</span><span class="p">,</span><span class="w">  </span><span class="c1">///&lt; [in] Time level index</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TracerIndex</span><span class="w"> </span><span class="c1">///&lt; [in] Global tracer index</span>
<span class="p">);</span>

<span class="k">static</span><span class="w"> </span><span class="n">HostArray2DReal</span><span class="w"> </span><span class="nf">getHostByIndex</span><span class="p">(</span>
<span class="w">   </span><span class="n">HostArray2DReal</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TracerArrayH</span><span class="p">,</span><span class="w"> </span><span class="c1">///&lt; [out] tracer host array</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TimeLevel</span><span class="p">,</span><span class="w">  </span><span class="c1">///&lt; [in] Time level index</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TracerIndex</span><span class="w"> </span><span class="c1">///&lt; [in] Global tracer index</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="getindex">
<h3><code class="docutils literal notranslate"><span class="pre">getIndex</span></code><a class="headerlink" href="#getindex" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">getIndex</span></code> returns the index of the tracer specified by the <code class="docutils literal notranslate"><span class="pre">TracerName</span></code>
argument. If the tracer is not found, it returns a negative integer.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="nf">getIndex</span><span class="p">(</span>
<span class="w">   </span><span class="n">I4</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TracerIndex</span><span class="p">,</span><span class="w">              </span><span class="c1">///&lt; [out] Tracer index</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TracerName</span><span class="w"> </span><span class="c1">///&lt; [in] Tracer name</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="getfieldbyindex">
<h3><code class="docutils literal notranslate"><span class="pre">getFieldByIndex</span></code><a class="headerlink" href="#getfieldbyindex" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">getFieldByIndex</span></code> returns the <code class="docutils literal notranslate"><span class="pre">Field</span></code> object associated with the tracer
specified by the <code class="docutils literal notranslate"><span class="pre">TracerIndex</span></code>. If not found, it returns <code class="docutils literal notranslate"><span class="pre">nullptr</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Returns a field by tracer index. If it does not exist, returns nullptr</span>
<span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Field</span><span class="o">&gt;</span>
<span class="n">getFieldByIndex</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="n">TracerIndex</span><span class="w"> </span><span class="c1">///&lt; [in] Global tracer index</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="updatetimelevels">
<h3><code class="docutils literal notranslate"><span class="pre">updateTimeLevels</span></code><a class="headerlink" href="#updatetimelevels" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">updateTimeLevels</span></code> increments the current time level by one. If the current
time level exceeds the number of time levels, it returns to <code class="docutils literal notranslate"><span class="pre">0</span></code>. It also
exchanges the halo cells of all tracers at the current time level and updates
the associated field with the new tracer arrays.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">/// Increment time levels</span>
<span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="nf">updateTimeLevels</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="getnumtracers">
<h3><code class="docutils literal notranslate"><span class="pre">getNumTracers</span></code><a class="headerlink" href="#getnumtracers" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">getNumTracers</span></code> returns the total number of tracers used in the simulation.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get total number of tracers</span>
<span class="k">static</span><span class="w"> </span><span class="n">I4</span><span class="w"> </span><span class="nf">getNumTracers</span><span class="p">();</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Reductions.html" class="btn btn-neutral float-left" title="Global Reductions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../design/OmegaV0ShallowWater.html" class="btn btn-neutral float-right" title="Omega V0: Shallow Water" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>